<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/e94d3d602c719429.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e94d3d602c719429.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-b84c169ac90f8974.js" defer=""></script><script src="/_next/static/chunks/framework-00b57966872fc495.js" defer=""></script><script src="/_next/static/chunks/main-1452d81522d66bc9.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b0e469cf26f5278f.js" defer=""></script><script src="/_next/static/chunks/175675d1-a2f4b19cd9daa73f.js" defer=""></script><script src="/_next/static/chunks/980-0fae37084f488ec8.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-c00e23fa748dc7e0.js" defer=""></script><script src="/_next/static/y95nYemEpD14YoeY38H-q/_buildManifest.js" defer=""></script><script src="/_next/static/y95nYemEpD14YoeY38H-q/_ssgManifest.js" defer=""></script><script src="/_next/static/y95nYemEpD14YoeY38H-q/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen"><header class="bg-sky-100 mb-8 py-4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous"/><script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js" integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous"></script><script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script><div class="container mx-auto flex justify-center"><a href="/">Shariff Faleel</a></div></header><main class="container mx-auto flex-1"><div class="prose text-justify mx-auto max-w-screen-xl prose-img:block prose-img:m-auto prose-img:max-h-96 prose-p:w-full"><h1>Personal website with nextjs and github pages</h1><div><p>I had implemented my personal website using Jekyll and hosted it using github pages. I have been wanting to implement it using react. So I took the leap and spent a weekend porting my old website to use react. While I had worked with react, I've been hearing good things about Next.js. I've been wanting to try Next.js as well for some time now. So I figured I'll use this as an opportunity to learn a little bit of Next.js as well. Googling around how I can get started with using Next.js for a static markdown blog, I came across an article by <a href="https://blog.openreplay.com/creating-a-markdown-blog-powered-by-next-js-in-under-an-hour">Chris Bongers on generating a Next.js markdown blog</a>. This basically shows the steps to setup the markdown blog:</p>
<ol>
<li>Initiate the project with <code>npm create-next-app .</code></li>
<li>Setting up <a href="https://tailwindcss.com">Tailwind CSS</a></li>
<li>Setting up a base layout for the pages (See my <a href="https://github.com/ahmed-shariff/ahmed-shariff.github.io/blob/master/components/BaseLayout.jsx">BaseLayout.jsx</a>).</li>
<li>Move all my markdown posts and realted images from the old Jekyll implementation.
<ul>
<li>The posts were all placed inside a <code>posts</code> directory in the root directory</li>
<li>The images were all moved to the directory <code>public/images</code> and the paths on the posts were also updated</li>
</ul>
</li>
<li>Load and render all Markdown posts with <a href="https://www.npmjs.com/package/gray-matter">grey-matter</a> and <a href="https://github.com/markdown-it/markdown-it">markdown-it</a> both on their own pages and also as a list on the home page.</li>
</ol>
<h2>Deploying using <code>react-gh-pages</code></h2>
<p>That allows me to locally run the site with <code>npm run dev</code>. But I need to export it to static a site and also figure out how to push it to github so that it can be deployed. I am using <a href="https://github.com/gitname/react-gh-pages">react gh-pages</a>. I followed the instructions there and updated the <code>project.json</code> file. That guide shows how to use deploy a react app. To make that compatible with Next.js I had to make the following changes:</p>
<ol>
<li>Update <code>package.json</code>: use the <code>out</code> directory, make sure the dotfiles are also included and the build also runs <code>next export</code> so that the <code>out</code> directory is generated.</li>
</ol>
<pre><code class="language-json">&quot;scripts&quot;: {
...
    &quot;deploy&quot;: &quot;gh-pages -d out -t&quot;,
...
    &quot;build&quot;: &quot;next build &amp;&amp; next export&quot;,
</code></pre>
<ol start="2">
<li>To tell github not to use Jekyll, create an empty file named <code>.nojekyll</code> in the <code>public</code> directory. This file should be in the root of the generated static project. When <code>next export</code> is run, it copies all the files in the <code>public</code> directory to the <code>out</code> directory, hence why it's created there.</li>
</ol>
<p>This allows me to have the site be deployed in the <code>gh-pages</code> branch (plus a fix for image loading, see below) and have the source code in the main branch of the repo.</p>
<h3>Images with <code>export</code></h3>
<p>When using <code>next export</code> Next.js requires an image loader to be used. At this point I wasn't interested in any of the optimizations, I wanted to load the images as is. Hence, I followed in instructions in the <a href="https://github.com/vercel/next.js/discussions/19065">discussion post in the Next.js repo</a> and created an <a href="https://github.com/ahmed-shariff/ahmed-shariff.github.io/blob/master/components/Image.js"><code>Image</code> component</a> to use when loading images. On top of that I had to set the <code>unoptimized</code> prop to <code>true</code> for it to work.</p>
<h2>Improve markdown rendering</h2>
<p>Finally, there were a few other things I had to fix to render Markdown files similar to what I had working with Jekyll.</p>
<h3>Links to other posts</h3>
<p>My old implementation linked to other posts using Liquid templates. Here, I used good old fashion regex to find these templates in the content once it's processed by <code>markdown-it</code> and replace it with an <code>&lt;a&gt;</code> tag:</p>
<pre><code class="language-js">function replaceJekyllLinks(content) {
    const regex = /\[([^\]]*)\]\((\{\{ *site\.baseurl *\}\})*\{% post_url ([^\s]*) %\}\)/g;
    return content.replace(regex, (text, p1, p2, p3) =&gt; {
        return `&lt;a href=&quot;<span class="katex-error" title="ParseError: KaTeX parse error: Expected &#x27;EOF&#x27;, got &#x27;&amp;&#x27; at position 5: {p3}&amp;̲quot;&amp;gt;" style="color:#cc0000">{p3}&amp;quot;&amp;gt;</span>{p1}&lt;/a&gt;`;
    })
}
</code></pre>
<p>Not the most efficient, but gets the job done.</p>
<h3>Math notation</h3>
<p>To get the math notations rendered correctly I wound up using <a href="https://github.com/KaTeX/KaTeX">katex</a>:</p>
<ol>
<li>Follow the <a href="https://katex.org/docs/autorender.html">instructions</a> from katex and added the CDN links to the base layout I had written (again not efficient, but gets the job done).</li>
<li>Configure katex to export only html.</li>
<li>Similar to what I had done with links, I used regex replace to find and render any math notations after the markdown is rendered to html and links are processed.</li>
</ol>
<pre><code class="language-js">function replaceMath(content) {
    const regex = /\<span class="katex-error" title="ParseError: KaTeX parse error: Unexpected character: &#x27;\&#x27; at position 6: (.+?)\̲" style="color:#cc0000">(.+?)\</span>/g;
    return content.replace(regex, (text, p1) =&gt; {
        return katex.renderToString(p1, {
            block: true,
            throwOnError: false,
            output: 'html'
        });
    });
}
</code></pre>
<p>Who cares about performance....</p>
<h3>Footnotes</h3>
<p>I used the <a href="https://github.com/markdown-it/markdown-it-footnote">Footnote plug-in</a> for <code>markdown-it</code>.</p>
<h3>Comments</h3>
<p>Previously I had used disqus for comments section in each post. This time around I wanted to use something a little less invasive. I went with <a href="https://giscus.app">giscus</a>. That was fairly easy to set up, just follow the instructions.</p>
<p>The complete code can be found in my <a href="https://github.com/ahmed-shariff/ahmed-shariff.github.io">github repo</a>.</p>
</div><giscus-widget id="comments" repo="ahmed-shariff/ahmed-shariff.github.io" repoid="MDEwOlJlcG9zaXRvcnkxMjU3MDU3Nzc=" category="Announcements" categoryid="DIC_kwDOB34eMc4COpxh" mapping="pathname" reactionsenabled="1" emitmetadata="0" inputposition="top" theme="light" lang="en" loading="lazy"></giscus-widget></div></main><footer class="bg-sky-100 mt-8 py-4"><div class="container mx-auto flex justify-center text-sm">© 2022 Shariff Faleel</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"layout":"post","comments":true,"title":"Personal website with nextjs and github pages","tags":["javascript","react","next"],"tagline":"In order to reduce the clutter, I keep track of the experiments using a emacs org-mode."},"content":"I had implemented my personal website using Jekyll and hosted it using github pages. I have been wanting to implement it using react. So I took the leap and spent a weekend porting my old website to use react. While I had worked with react, I've been hearing good things about Next.js. I've been wanting to try Next.js as well for some time now. So I figured I'll use this as an opportunity to learn a little bit of Next.js as well. Googling around how I can get started with using Next.js for a static markdown blog, I came across an article by [Chris Bongers on generating a Next.js markdown blog](https://blog.openreplay.com/creating-a-markdown-blog-powered-by-next-js-in-under-an-hour). This basically shows the steps to setup the markdown blog:\r\n\r\n1. Initiate the project with `npm create-next-app .`\r\n2. Setting up [Tailwind CSS](https://tailwindcss.com)\r\n3. Setting up a base layout for the pages (See my [BaseLayout.jsx](https://github.com/ahmed-shariff/ahmed-shariff.github.io/blob/master/components/BaseLayout.jsx)).\r\n4. Move all my markdown posts and realted images from the old Jekyll implementation.\r\n   - The posts were all placed inside a `posts` directory in the root directory\r\n   - The images were all moved to the directory `public/images` and the paths on the posts were also updated\r\n5. Load and render all Markdown posts with [grey-matter](https://www.npmjs.com/package/gray-matter) and [markdown-it](https://github.com/markdown-it/markdown-it) both on their own pages and also as a list on the home page.\r\n\r\n## Deploying using `react-gh-pages`\r\nThat allows me to locally run the site with `npm run dev`. But I need to export it to static a site and also figure out how to push it to github so that it can be deployed. I am using [react gh-pages](https://github.com/gitname/react-gh-pages). I followed the instructions there and updated the `project.json` file. That guide shows how to use deploy a react app. To make that compatible with Next.js I had to make the following changes:\r\n\r\n1. Update `package.json`: use the `out` directory, make sure the dotfiles are also included and the build also runs `next export` so that the `out` directory is generated.\r\n```json\r\n\"scripts\": {\r\n...\r\n    \"deploy\": \"gh-pages -d out -t\",\r\n...\r\n    \"build\": \"next build \u0026\u0026 next export\",\r\n```\r\n2. To tell github not to use Jekyll, create an empty file named `.nojekyll` in the `public` directory. This file should be in the root of the generated static project. When `next export` is run, it copies all the files in the `public` directory to the `out` directory, hence why it's created there.\r\n\r\nThis allows me to have the site be deployed in the `gh-pages` branch (plus a fix for image loading, see below) and have the source code in the main branch of the repo.\r\n\r\n### Images with `export`\r\n\r\nWhen using `next export` Next.js requires an image loader to be used. At this point I wasn't interested in any of the optimizations, I wanted to load the images as is. Hence, I followed in instructions in the [discussion post in the Next.js repo](https://github.com/vercel/next.js/discussions/19065) and created an [`Image` component](https://github.com/ahmed-shariff/ahmed-shariff.github.io/blob/master/components/Image.js) to use when loading images. On top of that I had to set the `unoptimized` prop to `true` for it to work.\r\n\r\n## Improve markdown rendering\r\n\r\nFinally, there were a few other things I had to fix to render Markdown files similar to what I had working with Jekyll.\r\n\r\n### Links to other posts\r\n\r\nMy old implementation linked to other posts using Liquid templates. Here, I used good old fashion regex to find these templates in the content once it's processed by `markdown-it` and replace it with an `\u003ca\u003e` tag:\r\n\r\n```js\r\nfunction replaceJekyllLinks(content) {\r\n    const regex = /\\[([^\\]]*)\\]\\((\\{\\{ *site\\.baseurl *\\}\\})*\\{% post_url ([^\\s]*) %\\}\\)/g;\r\n    return content.replace(regex, (text, p1, p2, p3) =\u003e {\r\n        return `\u003ca href=\"${p3}\"\u003e${p1}\u003c/a\u003e`;\r\n    })\r\n}\r\n```\r\n\r\nNot the most efficient, but gets the job done.\r\n\r\n### Math notation\r\n\r\nTo get the math notations rendered correctly I wound up using [katex](https://github.com/KaTeX/KaTeX):\r\n\r\n1. Follow the [instructions](https://katex.org/docs/autorender.html) from katex and added the CDN links to the base layout I had written (again not efficient, but gets the job done).\r\n2. Configure katex to export only html.\r\n3. Similar to what I had done with links, I used regex replace to find and render any math notations after the markdown is rendered to html and links are processed.\r\n\r\n```js\r\nfunction replaceMath(content) {\r\n    const regex = /\\$(.+?)\\$/g;\r\n    return content.replace(regex, (text, p1) =\u003e {\r\n        return katex.renderToString(p1, {\r\n            block: true,\r\n            throwOnError: false,\r\n            output: 'html'\r\n        });\r\n    });\r\n}\r\n```\r\n\r\nWho cares about performance....\r\n\r\n### Footnotes\r\n\r\nI used the [Footnote plug-in](https://github.com/markdown-it/markdown-it-footnote) for `markdown-it`.\r\n\r\n### Comments\r\n\r\nPreviously I had used disqus for comments section in each post. This time around I wanted to use something a little less invasive. I went with [giscus](https://giscus.app). That was fairly easy to set up, just follow the instructions.\r\n\r\nThe complete code can be found in my [github repo](https://github.com/ahmed-shariff/ahmed-shariff.github.io).\r\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2022-04-19-nextjs-gh-pages"},"buildId":"y95nYemEpD14YoeY38H-q","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>