<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/e94d3d602c719429.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e94d3d602c719429.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-00b57966872fc495.js" defer=""></script><script src="/_next/static/chunks/main-1452d81522d66bc9.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b0e469cf26f5278f.js" defer=""></script><script src="/_next/static/chunks/175675d1-a2f4b19cd9daa73f.js" defer=""></script><script src="/_next/static/chunks/980-0fae37084f488ec8.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-7cde54ec86176475.js" defer=""></script><script src="/_next/static/RaWL0xzu475sacfgiyh76/_buildManifest.js" defer=""></script><script src="/_next/static/RaWL0xzu475sacfgiyh76/_ssgManifest.js" defer=""></script><script src="/_next/static/RaWL0xzu475sacfgiyh76/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen"><header class="bg-sky-100 mb-8 py-4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous"/><script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js" integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous"></script><script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script><div class="container mx-auto flex justify-center"><a href="/">Shariff Faleel</a></div></header><main class="container mx-auto flex-1"><div class="prose text-justify mx-auto max-w-screen-xl prose-img:block prose-img:m-auto prose-img:max-h-96 prose-p:w-full"><h1>Exploring Haply</h1><div><p>Th second lab for the CanHap involved the <a href="https://2diy.haply.co">haply</a> device each one of the students had received. We were instructed to build a maze which can be explored using the haply device itself. haply is a 2 degree of freedom (2DoF) haptic device. We'll be using this device throughout the course, so the idea behind the lab is to get the hang of using the device and it's API.</p>
<h3>Setting up the device</h3>
<p>We had received the latest iteration of haply. The device arrived disassembled and we had to assemble the device ourself. When we received the device the online tutorials and guides for this version were still not publicly available. Well, that was not going to stop me from trying to put this together, as I was too excited to sit on my hands. During the first class we were shown the device in an online demo to get an idea of what we will be working with during this course. I used it as a guide to &quot;what goes where&quot; and managed to assemble the device; naturally, there were a few extra screws left (I had missed one screw under the end actuator and was told it will not be much of a problem). Since the mounts were 3D printed, I had to shave off some of the joints to make them fit, and pre-threading some of the screws, specially the ones at the base of the motors were not particularly comfortable given their position.</p>
<p>Once the device had setup, I tried following the instructions shared with us to modify the <a href="https://github.com/HaplyHaptics/Getting-Started">API for the previous haply</a> to run the demo. I ran into a few problems with the device. At the time, I had to focus on a few other projects I was working, so I shelved trying to fix them and revisited the device some time later after the devices new instructions and related code were made publicly available.</p>
<h3>The pieces</h3>
<p>Looking at the demos, there were three components I had to familiarize myself with:</p>
<ul>
<li>The <a href="https://processing.org">processing</a> programming environment: This is a java based eco-system for sketching.</li>
<li><a href="http://www.ricardmarxer.com/fisica/">Fisca</a>: This is a wrapper for the <a href="https://github.com/jbox2d/jbox2d">JBox2D</a> physics engine for processing.</li>
<li><a href="https://hapi.haply.co/docs/class_device.html#a92a42c44b2c89ebbf29316c4f36b7824">Haply hAPI</a>: The API to connect and control haply.</li>
</ul>
<p>Given my tendency to wait until the last moment to get things done, for this lab I focused on the later two. In trying to figure out what the demo maze was doing, there is a haply version of the <a href="https://haphub.github.io/hAPI_Fisica/class_h_virtual_coupling.html">fisca</a> library. The <code>HVirtualCoupling</code> class is what prompted me to look for the haply version of the library.</p>
<p>Going through the documentation, fisca is 2D physic engine, there was no surprise there. The processing environment had two main function that needs to be defined, the <code>setup</code> and <code>draw</code> functions. The <code>setup</code> function is where the world and the physics engine were setup and configured, and the <code>draw</code> function is called with every frame where the visual changes to the simulation are made. In addition to these processing functions, in order to sync the physical device with the virtual end-effector in the simulation, a separate thread is defined; this is where most of the hAPI code sits in. This thread basically communicates between the virtual and physical end-effector, the forces acting on each one of them, in order to keep them in sync. This is where the <code>HVirtualCoupling</code> class comes in. It basically gives the information to identify the current states of the two end-effectors, which can be used to discern what forces need to be applied on each one of them to synchronize them.</p>
<h3>Exploring different properties</h3>
<p>The code for the different sketches can be found on my <a href="https://github.com/ahmed-shariff/CanHap501_Lab_2.git">github page</a>. I'll link to appropriate lines when referring to different code segments. When running the sketches locally, you'd want to run the <code>setup.py</code> script to make sure the <code>code</code> and <code>Pantograph.java</code> files are linked to all the sketches:</p>
<pre><code class="language-bash">python setup.py
</code></pre>
<h4>Liquid density</h4>
<p>Looking a the example provided by haply, My first instinct was to explore a bit of liquid properties. The example had two different approaches of simulating the liquid properties. The first is by manually calculating the contacts and adding the forces. The second approach is to use the <code>FContact</code> based approach, where the <code>contactPersisted</code> and <code>contactEnded</code> functions are executed when the physics engine picks up a contact. I find the second approach to be &quot;attractive&quot;, so I went with that. I had had a few changes/fixes to it, such as using the <code>gravityAcceleration</code> and use more appropriate calculations for the different objects.</p>
<p>The first things I wanted to play with is try if having different densities will make a difference in the force feedback felt by the end-effectors. It was hard to say if there was any difference or even feedback just by adjusting the values and running them again. So I added three different <code>FBox</code>'s with different densities next to each other. The leftmost box with the least density (50) and the right most having the highest density (150). Note that each box has a different tint. With default densities defined for the object (40), they were afloat all the time as seen in the image below. Since making sure that the end-effector is pushing the objects requires a little bit of effort, I wasn't able to fully explore what I wanted to see. On a different note, the density values impact can be seen by amount of area submerged shifting with each box.
<img src="/assets/2021-02-05/3liquid_float.gif" alt="initial iteration"></p>
<p>To get a sense of the different densities I made the objects more dense than any of the liquid boxes (200). The test I ran with this setup can be seen in the following clip. This had a different problem: When an object is in contact with two boxes, as is the case when it is on the border of two boxes, a force is applied by both the boxes, making the object float when it is on the border. Then there is the wired behavior of the box object floating in the last liquid box, which I couldn't fully explain.
<img src="/assets/2021-02-05/3liquid.gif" alt="initial iteration"></p>
<p>Something else I found interesting is that moving the end-effector through the low density liquid box gave me a higher level resistance. Which is seen in the clip below. It turned out because of the values set for damping. This value is set to 700 when the end-effector comes into contact with the first liquid box. And I had overlooked that code segment, which resulted in the following behavior.
<img src="/assets/2021-02-05/3liquid_resistance.gif" alt="initial iteration"></p>
<p>Something else that came about is the force feedback due to the friction with the bottom edge of the layout. To look at this mode closely, I made the maze with one liquid box (removing it would have been better, but I already had a flag to switch between using 3 boxes and 1 box, so I just set that flag), and tried moving the objects to observe that, which can be seen in the following clip. Moving the box generate more feedback than the circle, which is expected.
<img src="/assets/2021-02-05/1liquid.gif" alt="initial iteration"></p>
<h4>Bouncing surfaces</h4>
<h3>Final thoughts</h3>
<p>PS: Last hour crunches and being curious is a dangerous combination as it is. Throwing in a full system upgrade &amp; emacs/system tinkering into that mix is a recipe for disaster. I lost whole day to system recovery, lol.</p>
</div></div></main><footer class="bg-sky-100 mt-8 py-4"><div class="container mx-auto flex justify-center text-sm">© 2022 Shariff Faleel</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"layout":"post","comments":true,"title":"Exploring Haply","tags":["course","hci"],"tagline":"Introducing myself to using haply, processing and fisca"},"content":"\r\nTh second lab for the CanHap involved the [haply](https://2diy.haply.co) device each one of the students had received. We were instructed to build a maze which can be explored using the haply device itself. haply is a 2 degree of freedom (2DoF) haptic device. We'll be using this device throughout the course, so the idea behind the lab is to get the hang of using the device and it's API.\r\n\r\n### Setting up the device\r\nWe had received the latest iteration of haply. The device arrived disassembled and we had to assemble the device ourself. When we received the device the online tutorials and guides for this version were still not publicly available. Well, that was not going to stop me from trying to put this together, as I was too excited to sit on my hands. During the first class we were shown the device in an online demo to get an idea of what we will be working with during this course. I used it as a guide to \"what goes where\" and managed to assemble the device; naturally, there were a few extra screws left (I had missed one screw under the end actuator and was told it will not be much of a problem). Since the mounts were 3D printed, I had to shave off some of the joints to make them fit, and pre-threading some of the screws, specially the ones at the base of the motors were not particularly comfortable given their position.\r\n\r\nOnce the device had setup, I tried following the instructions shared with us to modify the [API for the previous haply](https://github.com/HaplyHaptics/Getting-Started) to run the demo. I ran into a few problems with the device. At the time, I had to focus on a few other projects I was working, so I shelved trying to fix them and revisited the device some time later after the devices new instructions and related code were made publicly available.\r\n\r\n### The pieces\r\n\r\nLooking at the demos, there were three components I had to familiarize myself with:\r\n- The [processing](https://processing.org) programming environment: This is a java based eco-system for sketching.\r\n- [Fisca](http://www.ricardmarxer.com/fisica/): This is a wrapper for the [JBox2D](https://github.com/jbox2d/jbox2d) physics engine for processing.\r\n- [Haply hAPI](https://hapi.haply.co/docs/class_device.html#a92a42c44b2c89ebbf29316c4f36b7824): The API to connect and control haply.\r\n\r\nGiven my tendency to wait until the last moment to get things done, for this lab I focused on the later two. In trying to figure out what the demo maze was doing, there is a haply version of the [fisca](https://haphub.github.io/hAPI_Fisica/class_h_virtual_coupling.html) library. The `HVirtualCoupling` class is what prompted me to look for the haply version of the library. \r\n\r\nGoing through the documentation, fisca is 2D physic engine, there was no surprise there. The processing environment had two main function that needs to be defined, the `setup` and `draw` functions. The `setup` function is where the world and the physics engine were setup and configured, and the `draw` function is called with every frame where the visual changes to the simulation are made. In addition to these processing functions, in order to sync the physical device with the virtual end-effector in the simulation, a separate thread is defined; this is where most of the hAPI code sits in. This thread basically communicates between the virtual and physical end-effector, the forces acting on each one of them, in order to keep them in sync. This is where the `HVirtualCoupling` class comes in. It basically gives the information to identify the current states of the two end-effectors, which can be used to discern what forces need to be applied on each one of them to synchronize them.\r\n\r\n\r\n### Exploring different properties\r\n\r\nThe code for the different sketches can be found on my [github page](https://github.com/ahmed-shariff/CanHap501_Lab_2.git). I'll link to appropriate lines when referring to different code segments. When running the sketches locally, you'd want to run the `setup.py` script to make sure the `code` and `Pantograph.java` files are linked to all the sketches:\r\n\r\n```bash\r\npython setup.py\r\n```\r\n\r\n#### Liquid density\r\nLooking a the example provided by haply, My first instinct was to explore a bit of liquid properties. The example had two different approaches of simulating the liquid properties. The first is by manually calculating the contacts and adding the forces. The second approach is to use the `FContact` based approach, where the `contactPersisted` and `contactEnded` functions are executed when the physics engine picks up a contact. I find the second approach to be \"attractive\", so I went with that. I had had a few changes/fixes to it, such as using the `gravityAcceleration` and use more appropriate calculations for the different objects.\r\n\r\nThe first things I wanted to play with is try if having different densities will make a difference in the force feedback felt by the end-effectors. It was hard to say if there was any difference or even feedback just by adjusting the values and running them again. So I added three different `FBox`'s with different densities next to each other. The leftmost box with the least density (50) and the right most having the highest density (150). Note that each box has a different tint. With default densities defined for the object (40), they were afloat all the time as seen in the image below. Since making sure that the end-effector is pushing the objects requires a little bit of effort, I wasn't able to fully explore what I wanted to see. On a different note, the density values impact can be seen by amount of area submerged shifting with each box.\r\n![initial iteration](/assets/2021-02-05/3liquid_float.gif)\r\n\r\nTo get a sense of the different densities I made the objects more dense than any of the liquid boxes (200). The test I ran with this setup can be seen in the following clip. This had a different problem: When an object is in contact with two boxes, as is the case when it is on the border of two boxes, a force is applied by both the boxes, making the object float when it is on the border. Then there is the wired behavior of the box object floating in the last liquid box, which I couldn't fully explain.\r\n![initial iteration](/assets/2021-02-05/3liquid.gif)\r\n\r\nSomething else I found interesting is that moving the end-effector through the low density liquid box gave me a higher level resistance. Which is seen in the clip below. It turned out because of the values set for damping. This value is set to 700 when the end-effector comes into contact with the first liquid box. And I had overlooked that code segment, which resulted in the following behavior.\r\n![initial iteration](/assets/2021-02-05/3liquid_resistance.gif)\r\n\r\nSomething else that came about is the force feedback due to the friction with the bottom edge of the layout. To look at this mode closely, I made the maze with one liquid box (removing it would have been better, but I already had a flag to switch between using 3 boxes and 1 box, so I just set that flag), and tried moving the objects to observe that, which can be seen in the following clip. Moving the box generate more feedback than the circle, which is expected.\r\n![initial iteration](/assets/2021-02-05/1liquid.gif)\r\n\r\n#### Bouncing surfaces\r\n\r\n### Final thoughts\r\nPS: Last hour crunches and being curious is a dangerous combination as it is. Throwing in a full system upgrade \u0026 emacs/system tinkering into that mix is a recipe for disaster. I lost whole day to system recovery, lol. \r\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2021-02-05-canhap-lab2"},"buildId":"RaWL0xzu475sacfgiyh76","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>