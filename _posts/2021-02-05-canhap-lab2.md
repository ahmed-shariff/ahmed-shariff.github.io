---
layout: post
comments: true
title: Exploring Haply
tags: ["course", "hci"]
tagline: Introducing myself to using haply, processing and fisca
---

Th second lab for the CanHap involved the [haply](https://2diy.haply.co) device each one of the students had received. We were instructed to build a maze which can be explored using the haply device itself. haply is a 2 degree of freedom (2DoF) haptic device. We'll be using this device throughout the course, so the idea behind the lab is to get the hang of using the device and it's API.

### Setting up the device
We had received the latest iteration of haply. The device arrived disassembled and we had to assemble the device ourself. When we received the device the online tutorials and guides for this version were still not publicly available. Well, that was not going to stop me from trying to put this together, as I was too excited to sit on my hands. During the first class we were shown the device in an online demo to get an idea of what we will be working with during this course. I used it as a guide to "what goes where" and managed to assemble the device; naturally, there were a few extra screws left (I had missed one screw under the end actuator and was told it will not be much of a problem). Since the mounts were 3D printed, I had to shave off some of the joints to make them fit, and pre-threading some of the screws, specially the ones at the base of the motors were not particularly comfortable given their position.

Once the device had setup, I tried following the instructions shared with us to modify the [API for the previous haply](https://github.com/HaplyHaptics/Getting-Started) to run the demo. I ran into a few problems with the device. At the time, I had to focus on a few other projects I was working, so I shelved trying to fix them and revisited the device some time later after the devices new instructions and related code were made publicly available.

### The pieces

Looking at the demos, there were three components I had to familiarize myself with:
- The [processing](https://processing.org) programming environment: This is a java based eco-system for sketching.
- [Fisca](http://www.ricardmarxer.com/fisica/): This is a wrapper for the [JBox2D](https://github.com/jbox2d/jbox2d) physics engine for processing.
- [Haply hAPI](https://hapi.haply.co/docs/class_device.html#a92a42c44b2c89ebbf29316c4f36b7824): The API to connect and control haply.

Given my tendency to wait until the last moment to get things done, for this lab I focused on the later two. In trying to figure out what the demo maze was doing, there is a haply version of the [fisca](https://haphub.github.io/hAPI_Fisica/class_h_virtual_coupling.html) library. The `HVirtualCoupling` class is what prompted me to look for the haply version of the library. 

Going through the documentation, fisca is 2D physic engine, there was no surprise there. The processing environment had two main function that needs to be defined, the `setup` and `draw` functions. The `setup` function is where the world and the physics engine were setup and configured, and the `draw` function is called with every frame where the visual changes to the simulation are made. In addition to these processing functions, in order to sync the physical device with the virtual end-effector in the simulation, a separate thread is defined; this is where most of the hAPI code sits in. This thread basically communicates between the virtual and physical end-effector, the forces acting on each one of them, in order to keep them in sync. This is where the `HVirtualCoupling` class comes in. It basically gives the information to identify the current states of the two end-effectors, which can be used to discern what forces need to be applied on each one of them to synchronize them.


### The maze

### Final thoughts
PS: Last hour crunches and being curious is a dangerous combination as it is. Don't throw in a full system upgrade & emacs tinkering into that mix. I lost whole day to system recovery, lol. 
